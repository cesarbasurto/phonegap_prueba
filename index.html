<!DOCTYPE html>

<html>
    <head>
        <meta charset="utf-8" />
        <title>PhoneGap Demo</title>
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<script type="text/javascript" charset="utf-8"></script>
        <script type="text/javascript" charset="utf-8" src="cordova.js"></script>
		<link rel="stylesheet" href="http://code.jquery.com/mobile/1.3.1/jquery.mobile-1.3.1.min.css">
		<script src="http://code.jquery.com/jquery-1.9.1.min.js"></script>
		<script src="http://code.jquery.com/mobile/1.3.1/jquery.mobile-1.3.1.min.js"></script>
		<script type="text/javascript" charset="utf-8">
		//*********************************************************
		// Wait for Cordova to Load
		//*********************************************************
		
	    var rootDir = "file:///mnt/sdcard";
	    var appHomeDir = "Android/data/com.ventusmoso.pg2_jqm";
	
	    //*********************************************************    
	    // Prepare dir for file and storage features
	    //*********************************************************  
	    function createFileDir() {
	
	        function fsOnError(error) {
	            alert("Cannot get to root file system. Code: " + error.message)
	        }
	        function dirOnError(error) {
	            alert("Cannot create dir. Code: " + error.code)
	        }
	        function fsOnSuccess(fileSystem) {
	            fileSystem.root.getDirectory(appHomeDir, {create: true, exclusive: false}, null, dirOnError);
	        }
	
	        window.requestFileSystem( LocalFileSystem.PERSISTENT, 0, fsOnSuccess, fsOnError );
	    }


    	document.addEventListener("deviceready", onDeviceReady, false);
    	function onDeviceReady() {
			 $("#main h1#appTitle").html("PhoneGap " + device.cordova + " Demo");       
	       // addBackbuttonListener();
	        createFileDir();
			
		}
		
		document.addEventListener("backbutton", function() {
            if ( $('.ui-page-active').attr('id') == 'main') {
                exitAppPopup();
            } else {
                history.back();             
            }
        }, false);
        
        function exitAppPopup() {
		    navigator.notification.confirm(
		          'Exit PhoneGap ' + device.cordova + ' Demo?'
		        , function(button) {
		              if (button == 2) {
		                  navigator.app.exitApp();
		              } 
		          }
		        , 'Exit'
		        , 'No,Yes'
		    );  
		    return false;
		}
		
		
        
	     function updateNotificationStatus(status) {
	        $("#notificationStatus").empty();
	        $("#notificationStatus").append(status).trigger("create");
	    }
	
	    function getNotificationReady() {
	        updateNotificationStatus("");   
	    }
	    
	    function alertCB() {
	        updateNotificationStatus("Alert is picked");
	    }
    
	    function confirmCB(button) {
	        var btnText;
	        
	        switch (button) {
	            case 1:
	                btnText = "Green";
	                break;
	            case 2:
	                btnText = "Red";
	                break;
	        }
	
	        updateNotificationStatus("Confirm: You selected the \"" + btnText +  "\" button");
	        $("#colorBox").css({"background-color": btnText})
	        $("#notificationConfirm").popup({positionTo: "window"});
	        $("#notificationConfirm").popup("open");        
	    }
	    
	    function alertNotification() {
	        navigator.notification.alert(
	              'Alert Notification'
	            , alertCB
	            , 'Title | Alert'
	            , 'Done'
	        );
	    }
	    function confirmNotification() {
	        navigator.notification.confirm(
	              'Which color do you like most?'
	            , confirmCB
	            , 'Title | Confirm'
	            , 'Green,Red'
	        );  
	    }
	    function beepNotification() {
	        navigator.notification.beep(3); 
	        updateNotificationStatus("Beep is picked");
	    }
	    function vibrateNotification() {
	        navigator.notification.vibrate(2000);
	        updateNotificationStatus("Vibrate is picked");
	    }
	    //*********************************************************    
		// Accelerometer Info function
		//*********************************************************
		var accelerometerInt;
		
		function updateAccelerationStatus(status) {
		    $("#acelerometerStatus").html(status);
		    return false;
		}
		
		function getAccelonSuccess(acceleration) {
		    $("#accX").html(textFormat(acceleration.x));
		    $("#accY").html(textFormat(acceleration.y));
		    $("#accZ").html(textFormat(acceleration.z));
		    $("#accTime").html(toDateStr(new Date(acceleration.timestamp)));
			return false;
		}
		
		function getAccelonError() {
		    var contents  = addGridRow("a", boldLabel("ERROR:"));
		        contents += addGridRow("b", "Cannot get accelerometer info");
		
		    $("#accelerometerProperties").html(contents);
		    updateAccelerationStatus("ERROR");
		    return false;
		}
		
		function updateAccelerometer() {
		    if ( accelerometerInt != undefined ) {
		        navigator.accelerometer.clearWatch(accelerometerInt);
		    }
		
		    var uDefFreq = $("#acFreq").val();
		
		    if ( uDefFreq > 0 && uDefFreq < 11 ) {
		        accelerometerInt = navigator.accelerometer.watchAcceleration(getAccelonSuccess, getAccelonError, {frequency: uDefFreq * 1000});
		        updateAccelerationStatus("Updating... Frequency: " + uDefFreq + " sec");
		    } else {
		            updateAccelerationStatus("ERROR: Freq must be between 1 and 10");
		    }
		    return false;
		}
		
		function stopUpdateAccelerometer() {
		    navigator.accelerometer.clearWatch(accelerometerInt);
		    accelerometerInt = undefined;
		    updateAccelerationStatus("Stopped");
		    return false;
		}
		
		function getAccelerometerReady() {      
		  
		    if ( accelerometerInt != undefined ) {
		        navigator.accelerometer.clearWatch(accelerometerInt);
		    }
		  
		    if ( $("#acFreq").val() != 1 ) {
		        $("#acFreq").val(1).slider("refresh");  // reset slider to 1
		    }
			navigator.accelerometer.getCurrentAcceleration(getAccelonSuccess, getAccelonError);
		    updateAccelerationStatus("Initialized");
			$('#startUpdateButton').on('vclick', function(e) {
		        e.preventDefault();
		        updateAccelerometer();
		        return false;
		    });
		    $('#stopUpdateButton').on('vclick', function(e){
		        e.preventDefault();
		        stopUpdateAccelerometer();
		        return false;
		    }); 
		}
		
		//*********************************************************    
		// initialize the environment
		//********************************************************* 
		$("#accelerometerMainPage").bind("pagebeforeshow", function() { getAccelerometerReady(); } );
		</script>
	</head>
	<body>
			<!---------------------------------- Main Page --------------------------------------->
		<div data-role="page" id="main">
		    <div data-role="header" data-position="fixed">
		        <h1 id="appTitle"></h1>
		    </div>
		    <div data-role="content">   
		    <ul data-role="listview" data-inset="true" data-filter="true">
		        <li><a href="#notificationCap" data-transition="slide" onclick="getNotificationReady();">Notification</a></li>
		        <li><a href="#accelerometerMainPage" data-transition="slide" onclick="getNotificationReady();">Notification</a></li>
		    </ul>
		    </div>
		</div>
		
		<!---------------------------------- Notification ------------------------------------>
		<div data-role="page" data-add-back-btn="true" back-btn-text="back" id="notificationCap">
		    <div data-role="header">
		        <h1>Notification</h1>
		    </div>
		    <div data-role="content">
		        <ul data-role="listview" data-inset="true">
		            <li><a href="#" onclick="alertNotification();"  >Alert</a></li>
		            <li><a href="#" onclick="confirmNotification();">Confirm</a></li>
		            <li><a href="#" onclick="beepNotification();"   >Beep</a></li>
		            <li><a href="#" onclick="vibrateNotification();">Vibrate</a></li>
		        </ul>
		        <div class="mesgBox">
		            <ul class="smFont">
		                <li>Alert   - Show alert box</li>
		                <li>Confirm - Show confirm message box</li>
		                <li>Beep    - Will beep 3 times</li>
		                <li>Vibrate - Will vibrate for 2 sec</li>
		            </ul>           
		        </div>  
		
		<!---------------------------------- Notification: Confirm --------------------------->
		        <div data-role="popup" id="notificationConfirm" class="ui-content" data-theme="e" data-transitione="pop">
		            <h3>Confirmation - Selection</h3>
		            <h5 class="hlabel">You've picked...</h5>
		            <div id="colorBox"></div>
		            <button onclick="$('#notificationConfirm').popup('close');">Close</button>
		        </div>
		    </div>
		    <div data-role="footer">
		        <div id="notificationStatus"></div>
		    </div>          
		</div>
	    <div data-role="page" id="accelerometerMainPage" data-add-back-btn="true" back-btn-text="back">
        <div data-role="header">
            <a href="" data-rel="back" data-role="button" data-icon="arrow-l" data-theme="a" class="ui-btn-left">back</a>
            <h1>Accelerometer</h1>
        </div>
        <div data-role="content">
            <div id="accelerometerProperties" class="mesgBox ui-grid-a">
            <div class='ui-block-a'>Acceleration X:</div><div class='ui-block-b' id="accX"></div>
            <div class='ui-block-a'>Acceleration Y:</div><div class='ui-block-b' id="accY"></div>
            <div class='ui-block-a'>Acceleration Z:</div><div class='ui-block-b' id="accZ"></div>
            <div class='ui-block-a'>Timestemp:</div><div class='ui-block-b' id="accTime"></div>
            </div>
            <div data-role="fieldcontain">
                <form>
                    <label class="smFont" for="acFreq">Update frequency (in seconds)</label>
                    <input type="range" name="acFreq" id="acFreq" value="1" min="0" max="10" step="1" data-highlight="true" />
                </form>
                <a href="#" id="startUpdateButton" data-role="button">Start update</a>
                <a href="#" id="stopUpdateButton"  data-role="button">Stop update</a>
            </div>
        </div>
        <div data-role="footer">
            <div id="acelerometerStatus"></div>
        </div>

        <script type="text/javascript" charset="utf-8" src="js/accelerometer-min.js"></script>
    </div>
	</body>
</html>
