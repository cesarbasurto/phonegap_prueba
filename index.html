<!DOCTYPE html>

<html>
    <head>
        <meta charset="utf-8" />
        <title>PhoneGap Demo</title>
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<script type="text/javascript" charset="utf-8"></script>
        <script type="text/javascript" charset="utf-8" src="cordova.js"></script>
		<link rel="stylesheet" href="http://code.jquery.com/mobile/1.3.1/jquery.mobile-1.3.1.min.css">
		<script src="http://code.jquery.com/jquery-1.9.1.min.js"></script>
		<script src="http://code.jquery.com/mobile/1.3.1/jquery.mobile-1.3.1.min.js"></script>
		<script type="text/javascript" charset="utf-8">
		//*********************************************************
		// Wait for Cordova to Load
		//*********************************************************
		
	    var rootDir = "file:///mnt/sdcard";
	    var appHomeDir = "Android/data/com.ventusmoso.pg2_jqm";
	
	    //*********************************************************    
	    // Prepare dir for file and storage features
	    //*********************************************************  
	    function createFileDir() {
	
	        function fsOnError(error) {
	            alert("Cannot get to root file system. Code: " + error.message)
	        }
	        function dirOnError(error) {
	            alert("Cannot create dir. Code: " + error.code)
	        }
	        function fsOnSuccess(fileSystem) {
	            fileSystem.root.getDirectory(appHomeDir, {create: true, exclusive: false}, null, dirOnError);
	        }
	
	        window.requestFileSystem( LocalFileSystem.PERSISTENT, 0, fsOnSuccess, fsOnError );
	    }


    	document.addEventListener("deviceready", onDeviceReady, false);
    	function onDeviceReady() {
			 $("#main h1#appTitle").html("PhoneGap " + device.cordova + " Demo");       
	       // addBackbuttonListener();
	        createFileDir();
			
		}
		
		document.addEventListener("backbutton", function() {
            if ( $('.ui-page-active').attr('id') == 'main') {
                exitAppPopup();
            } else {
                history.back();             
            }
        }, false);
        
        function exitAppPopup() {
		    navigator.notification.confirm(
		          'Exit PhoneGap ' + device.cordova + ' Demo?'
		        , function(button) {
		              if (button == 2) {
		                  navigator.app.exitApp();
		              } 
		          }
		        , 'Exit'
		        , 'No,Yes'
		    );  
		    return false;
		}
		
		
        
	     function updateNotificationStatus(status) {
	        $("#notificationStatus").empty();
	        $("#notificationStatus").append(status).trigger("create");
	    }
	
	    function getNotificationReady() {
	        updateNotificationStatus("");   
	    }
	    
	    function alertCB() {
	        updateNotificationStatus("Alert is picked");
	    }
    
	    function confirmCB(button) {
	        var btnText;
	        
	        switch (button) {
	            case 1:
	                btnText = "Green";
	                break;
	            case 2:
	                btnText = "Red";
	                break;
	        }
	
	        updateNotificationStatus("Confirm: You selected the \"" + btnText +  "\" button");
	        $("#colorBox").css({"background-color": btnText})
	        $("#notificationConfirm").popup({positionTo: "window"});
	        $("#notificationConfirm").popup("open");        
	    }
	    
	    function alertNotification() {
	        navigator.notification.alert(
	              'Alert Notification'
	            , alertCB
	            , 'Title | Alert'
	            , 'Done'
	        );
	    }
	    function confirmNotification() {
	        navigator.notification.confirm(
	              'Which color do you like most?'
	            , confirmCB
	            , 'Title | Confirm'
	            , 'Green,Red'
	        );  
	    }
	    function beepNotification() {
	        navigator.notification.beep(3); 
	        updateNotificationStatus("Beep is picked");
	    }
	    function vibrateNotification() {
	        navigator.notification.vibrate(2000);
	        updateNotificationStatus("Vibrate is picked");
	    }
	   
		</script>
		
		<script type="text/javascript" charset="utf-8"> 
    //*********************************************************    
    // Geolocation Capabilities
    //*********************************************************
    var geolocationInt;
    
    function updateGeolocationStatus(status) {
        $("#geolocationStatus").empty();
        $("#geolocationStatus").append(status);
    }
    
    function geolocationSuccess(position) {
        $("#geolocationProperties").empty();
        
        $("#geolocationProperties").append(addGridRow("a", boldLabel("Latitude:")));          
        $("#geolocationProperties").append(addGridRow("b", textFormat(position.coords.latitude)));
        
        $("#geolocationProperties").append(addGridRow("a", boldLabel("Longitude:")));         
        $("#geolocationProperties").append(addGridRow("b", textFormat(position.coords.longitude)));
        
        $("#geolocationProperties").append(addGridRow("a", boldLabel("Altitude:")));          
        $("#geolocationProperties").append(addGridRow("b", textFormat(position.coords.altitude)));
        
        $("#geolocationProperties").append(addGridRow("a", boldLabel("Accuracy:")));          
        $("#geolocationProperties").append(addGridRow("b", textFormat(position.coords.accuracy)));
        
        $("#geolocationProperties").append(addGridRow("a", boldLabel("Altitude Accuracy:"))); 
        $("#geolocationProperties").append(addGridRow("b", textFormat(position.coords.altitudeAccuracy)));
        
        $("#geolocationProperties").append(addGridRow("a", boldLabel("Heading:")));           
        $("#geolocationProperties").append(addGridRow("b", textFormat(position.coords.heading)));
        
        $("#geolocationProperties").append(addGridRow("a", boldLabel("Speed:")));             
        $("#geolocationProperties").append(addGridRow("b", textFormat(position.coords.speed)));
        
        $("#geolocationProperties").append(addGridRow("a", boldLabel("Timestamp:"))); 
        $("#geolocationProperties").append(addGridRow("b", toDateStr(new Date(position.timestamp))));
            
    }
    function geolocationError(error) {
        $("#geolocationProperties").append(addGridRow('a', boldLabel("ERROR:")));
        $("#geolocationProperties").append(addGridRow('b', error.message + " Code: " + error.code));
        updateGeolocationStatus("ERROR");
    } 

    function getGeolocationInfo() {
        if ( geolocationInt != undefined ) {
            navigator.geolocation.clearWatch(geolocationInt);
        }
        if ( $("#geolocFreq").val() != 1 ) {
            $("#geolocFreq").val(1).slider("refresh");
        }
        
        navigator.geolocation.getCurrentPosition(geolocationSuccess, geolocationError, {enableHighAccuracy:true, timeout:5000});
        updateGeolocationStatus("Initialized");     
    }
    
    function updateGeolocation() {
        if ( geolocationInt != undefined ) {
            navigator.geolocation.clearWatch(geolocationInt);
        }
        
        var uDefFreq = $("#geolocFreq").val();
        
        if ( uDefFreq > 0 ) {
            // The Android 2.x simulators will not return a geolocation result unless the enableHighAccuracy option is set to true. 
            geolocationInt = navigator.geolocation.watchPosition(geolocationSuccess, geolocationError, {enableHighAccuracy:true, timeout:5000, maximumAge: uDefFreq * 1000});
        }
        updateGeolocationStatus("Updating... Frequency: " + uDefFreq + " sec");
    }
    
    function stopUpdateGeolocation() {
        navigator.geolocation.clearWatch(geolocationInt);
        geolocationInt = undefined;
        updateGeolocationStatus("Stopped");
    }
</script>
	</head>
	<body>
			<!---------------------------------- Main Page --------------------------------------->
		<div data-role="page" id="main">
		    <div data-role="header" data-position="fixed">
		        <h1 id="appTitle"></h1>
		    </div>
		    <div data-role="content">   
		    <ul data-role="listview" data-inset="true" data-filter="true">
		        <li><a href="#notificationCap" data-transition="slide" onclick="getNotificationReady();">Notification</a></li>
		        <li><a href="#geolocationInfo" data-transition="slide" onclick="getGeolocationInfo();">Geolocation</a></li>
		     </ul>
		    </div>
		</div>
		
		<!---------------------------------- Notification ------------------------------------>
		<div data-role="page" data-add-back-btn="true" back-btn-text="back" id="notificationCap">
		    <div data-role="header">
		        <h1>Notification</h1>
		    </div>
		    <div data-role="content">
		        <ul data-role="listview" data-inset="true">
		            <li><a href="#" onclick="alertNotification();"  >Alert</a></li>
		            <li><a href="#" onclick="confirmNotification();">Confirm</a></li>
		            <li><a href="#" onclick="beepNotification();"   >Beep</a></li>
		            <li><a href="#" onclick="vibrateNotification();">Vibrate</a></li>
		        </ul>
		        <div class="mesgBox">
		            <ul class="smFont">
		                <li>Alert   - Show alert box</li>
		                <li>Confirm - Show confirm message box</li>
		                <li>Beep    - Will beep 3 times</li>
		                <li>Vibrate - Will vibrate for 2 sec</li>
		            </ul>           
		        </div>  
		
		<!---------------------------------- Notification: Confirm --------------------------->
		        <div data-role="popup" id="notificationConfirm" class="ui-content" data-theme="e" data-transitione="pop">
		            <h3>Confirmation - Selection</h3>
		            <h5 class="hlabel">You've picked...</h5>
		            <div id="colorBox"></div>
		            <button onclick="$('#notificationConfirm').popup('close');">Close</button>
		        </div>
		    </div>
		    <div data-role="footer">
		        <div id="notificationStatus"></div>
		    </div>          
		</div>
		<div data-role="page" data-add-back-btn="true" back-btn-text="back" id="geolocationInfo">
		    <div data-role="header">
		        <h1>Geolocation</h1>
		    </div>
		    <div data-role="content">
		        <div id="geolocationProperties" class="mesgBox ui-grid-a"></div>
		        <div data-role="fieldcontain">
		            <form>
		                <label class="smFont" for="geolocFreq">Update frequency (in seconds)</label>
		                <input type="range" name="geolocFreq" id="geolocFreq" value="1" min="0" max="10" step="1" data-highlight="true"/>
		            </form>
		            <a href="#" data-role="button" onclick="updateGeolocation();">Start update</a>
		            <a href="#" data-role="button" onclick="stopUpdateGeolocation();">Stop update</a>
		        </div>
		    </div>
		    <div data-role="footer">
		        <div id="geolocationStatus"></div>
		    </div>
		</div>
	</body>
</html>
